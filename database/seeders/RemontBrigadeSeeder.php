<?php

namespace Database\Seeders;

use App\Models\RemontBrigade;
use App\Models\RemontBrigadeData;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\Schema;

class RemontBrigadeSeeder extends Seeder
{
    public function run(): void
    {
        // Отключаем проверку внешних ключей
        Schema::disableForeignKeyConstraints();

        // Очищаем таблицы перед заполнением
        RemontBrigadeData::truncate();
        RemontBrigade::truncate();

        // Включаем проверку внешних ключей обратно
        Schema::enableForeignKeyConstraints();

        $year = 2025;

        // Структура данных: Цех => [бригады]
        $structure = [
            'Цех № 1' => ['ОМС-1', 'ОМС-2', 'ОМС-3', 'ОМС-4', 'ОМС-5', 'ОМС-6', 'ОМС-7', 'ОМС-8', 'ОМС-9'],
            'Цех № 2' => ['ОМС-13', 'ОМС-14', 'ОМС-15', 'ОМС-16', 'ОМС-17', 'ОМС-18', 'ОМС-19', 'ОМС-20', 'ОМС-21'],
            'Цех № 3' => ['ОМС-22', 'ОМС-23', 'ОМС-24', 'ОМС-25', 'ОМС-26', 'ОМС-27', 'ОМС-28', 'ОМС-29', 'ОМС-30'],
            'Цех № 4' => ['ОМС-37', 'ОМС-38', 'ОМС-39', 'ОМС-40', 'ОМС-41', 'ОМС-42', 'ОМС-43', 'ОМС-44', 'ОМС-45'],
            'Цех № 5' => ['ОМС-10', 'ОМС-11', 'ОМС-12', 'ОМС-31', 'ОМС-32', 'ОМС-33', 'ОМС-34', 'ОМС-35', 'ОМС-36'],
        ];

        // Данные по месяцам: бригада => [[план, факт], [план, факт], ...]
        // Месяцы с 1 по 11 (январь - ноябрь), декабрь без данных
        $brigadeData = [
            // Цех № 1
            'ОМС-1' => [[1,0], [2,1], [1,1], [1,0], [2,1], [1,1], [1,2], [1,1], [1,3], [2,1], [1,1]],
            'ОМС-2' => [[1,1], [1,1], [2,1], [1,1], [1,null], [2,2], [1,2], [1,null], [2,2], [1,2], [1,3]],
            'ОМС-3' => [[1,1], [1,2], [2,2], [1,1], [1,1], [1,2], [2,1], [1,null], [2,2], [1,1], [1,1]],
            'ОМС-4' => [[1,2], [1,2], [1,1], [1,0], [1,2], [2,3], [1,2], [2,1], [1,2], [2,2], [1,2]],
            'ОМС-5' => [[2,2], [1,2], [1,1], [2,2], [1,null], [1,1], [1,2], [1,2], [1,1], [1,2], [1,3]],
            'ОМС-6' => [[1,2], [1,1], [1,1], [1,2], [1,1], [2,0], [1,0], [2,1], [1,1], [1,1], [2,0]],
            'ОМС-7' => [[2,2], [1,1], [1,0], [1,2], [1,1], [1,2], [2,2], [1,1], [1,1], [1,2], [2,2]],
            'ОМС-8' => [[1,2], [1,1], [1,2], [1,1], [2,2], [1,3], [1,2], [2,2], [1,3], [1,2], [1,2]],
            'ОМС-9' => [[1,2], [1,1], [1,0], [1,0], [1,1], [1,2], [2,0], [1,1], [1,null], [1,3], [1,2]],

            // Цех № 2
            'ОМС-13' => [[1,0], [1,1], [1,2], [1,0], [1,2], [2,1], [1,3], [1,1], [2,1], [1,2], [1,1]],
            'ОМС-14' => [[2,3], [1,0], [1,2], [2,0], [1,2], [1,0], [1,1], [1,1], [2,3], [1,null], [1,1]],
            'ОМС-15' => [[1,0], [1,1], [1,1], [1,3], [1,1], [2,1], [1,1], [2,2], [1,1], [2,null], [1,1]],
            'ОМС-16' => [[1,0], [1,2], [1,1], [2,0], [1,1], [1,2], [1,1], [1,2], [1,2], [2,1], [1,1]],
            'ОМС-17' => [[1,0], [1,2], [1,3], [1,0], [2,2], [1,1], [2,3], [1,1], [1,null], [1,1], [2,2]],
            'ОМС-18' => [[1,2], [1,2], [2,0], [1,2], [1,1], [1,2], [1,1], [2,1], [1,1], [1,2], [1,3]],
            'ОМС-19' => [[1,1], [2,2], [1,2], [1,1], [1,3], [2,1], [1,2], [2,1], [1,1], [1,2], [1,1]],
            'ОМС-20' => [[1,2], [1,1], [1,1], [1,1], [2,1], [1,2], [2,1], [1,2], [1,1], [1,null], [2,2]],
            'ОМС-21' => [[1,3], [2,0], [1,1], [1,2], [1,2], [1,1], [1,0], [1,2], [2,2], [1,2], [2,2]],

            // Цех № 3
            'ОМС-22' => [[1,1], [1,1], [1,1], [1,0], [1,3], [2,0], [1,0], [1,1], [2,1], [1,1], [1,2]],
            'ОМС-23' => [[1,1], [1,2], [1,0], [1,1], [1,1], [2,1], [1,0], [1,1], [2,1], [1,null], [1,1]],
            'ОМС-24' => [[1,1], [2,2], [1,1], [1,2], [1,1], [1,1], [2,1], [1,2], [1,1], [1,2], [2,1]],
            'ОМС-25' => [[1,2], [1,2], [1,3], [1,0], [1,1], [1,1], [2,1], [1,2], [1,null], [2,1], [1,2]],
            'ОМС-26' => [[1,0], [1,1], [1,2], [2,0], [1,1], [1,0], [2,2], [1,3], [2,2], [1,3], [1,3]],
            'ОМС-27' => [[1,1], [1,1], [2,2], [1,3], [1,1], [1,1], [1,1], [2,1], [1,1], [1,2], [1,0]],
            'ОМС-28' => [[1,1], [1,2], [1,2], [1,1], [2,1], [1,1], [1,2], [2,1], [1,1], [2,2], [1,2]],
            'ОМС-29' => [[2,1], [1,2], [1,1], [1,1], [2,2], [1,1], [1,1], [2,2], [1,1], [1,1], [1,1]],
            'ОМС-30' => [[1,null], [2,0], [1,1], [2,1], [1,2], [1,0], [1,1], [1,1], [1,1], [1,2], [1,1]],

            // Цех № 4
            'ОМС-37' => [[2,0], [1,2], [1,1], [1,1], [1,1], [2,2], [1,2], [2,2], [1,null], [1,2], [1,1]],
            'ОМС-38' => [[1,2], [1,1], [2,2], [1,1], [1,1], [2,2], [1,2], [2,2], [1,2], [1,null], [1,2]],
            'ОМС-39' => [[1,2], [2,0], [1,0], [1,0], [1,null], [1,null], [2,0], [1,null], [1,null], [2,null], [1,null]],
            'ОМС-40' => [[1,2], [1,2], [1,0], [2,3], [1,2], [1,3], [2,1], [1,null], [1,3], [1,2], [1,1]],
            'ОМС-41' => [[1,1], [1,1], [1,2], [1,1], [1,2], [1,1], [1,0], [1,3], [2,1], [1,2], [2,2]],
            'ОМС-42' => [[1,2], [1,2], [1,0], [1,2], [2,2], [1,1], [1,1], [1,1], [2,2], [1,1], [1,1]],
            'ОМС-43' => [[1,2], [1,2], [2,4], [1,2], [1,2], [1,2], [1,2], [1,null], [2,1], [1,2], [1,2]],
            'ОМС-44' => [[1,1], [1,2], [1,0], [1,2], [2,1], [1,1], [1,0], [2,2], [1,1], [2,null], [1,0]],
            'ОМС-45' => [[1,2], [1,0], [1,1], [1,2], [2,1], [1,0], [2,2], [1,2], [1,2], [1,3], [1,1]],

            // Цех № 5
            'ОМС-10' => [[1,1], [2,0], [1,2], [1,2], [1,2], [2,3], [1,1], [1,1], [2,1], [1,2], [1,1]],
            'ОМС-11' => [[1,2], [1,1], [1,1], [1,3], [1,2], [2,3], [2,2], [1,1], [1,3], [1,1], [2,1]],
            'ОМС-12' => [[1,2], [1,2], [1,2], [1,0], [1,2], [2,1], [1,1], [2,1], [1,1], [2,2], [1,0]],
            'ОМС-31' => [[1,2], [1,2], [2,2], [1,1], [1,1], [1,2], [1,2], [2,1], [1,null], [1,1], [1,2]],
            'ОМС-32' => [[1,1], [1,2], [1,1], [2,0], [1,1], [1,1], [2,1], [1,null], [1,null], [1,1], [1,0]],
            'ОМС-33' => [[1,3], [1,1], [1,2], [1,2], [2,2], [1,1], [1,2], [2,1], [1,1], [2,1], [1,0]],
            'ОМС-34' => [[1,1], [1,1], [1,1], [1,2], [2,1], [1,2], [1,1], [1,2], [1,1], [1,null], [2,1]],
            'ОМС-35' => [[1,1], [1,0], [2,1], [1,3], [1,1], [1,1], [2,1], [1,null], [1,2], [1,2], [1,2]],
            'ОМС-36' => [[2,1], [1,1], [1,1], [1,0], [1,1], [2,0], [1,2], [1,null], [2,3], [1,2], [1,0]],
        ];

        // Создаем цехи и бригады
        foreach ($structure as $workshopName => $brigades) {
            // Создаем цех
            $workshop = RemontBrigade::create(['name' => $workshopName, 'parent_id' => null]);

            // Создаем бригады и их данные
            foreach ($brigades as $brigadeName) {
                $brigade = RemontBrigade::create([
                    'name' => $brigadeName,
                    'parent_id' => $workshop->id,
                ]);

                // Добавляем данные по месяцам
                if (isset($brigadeData[$brigadeName])) {
                    foreach ($brigadeData[$brigadeName] as $monthIndex => $values) {
                        $month = $monthIndex + 1; // месяцы 1-11
                        $plan = $values[0] ?? 0;
                        $fact = $values[1] ?? 0; // null заменяем на 0

                        RemontBrigadeData::create([
                            'brigade_id' => $brigade->id,
                            'month_year' => RemontBrigadeData::formatMonthYear($year, $month),
                            'plan' => $plan,
                            'fact' => $fact,
                        ]);
                    }
                }
            }
        }

        $this->command->info('RemontBrigade data seeded successfully!');
        $this->command->info('Created ' . RemontBrigade::workshops()->count() . ' workshops');
        $this->command->info('Created ' . RemontBrigade::brigades()->count() . ' brigades');
        $this->command->info('Created ' . RemontBrigadeData::count() . ' monthly records');
    }
}
